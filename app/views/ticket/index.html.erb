<div class="row">
    <div class="col-lg-12">
        <section class="panel">
            <header class="panel-heading">
                Tickets
            </header>
            <div class="panel-body">
                <div class="pull-right">
                    <%= form_tag  url_for(:controller => :ticket, :action => :index), method: 'get', class: 'form-inline', role: 'form', id: 'form_filter_ticket' do %>
                        <div class="form-group">
                            <select class="form-control" name="ticket_state">
                                <option value="-2">Todas</option>
                                <% for state in State.all %>
                                <% if state.id == params[:ticket_state].to_i%>
                                <option selected="" value="<%= state.id %>"><%= state.name %></option>
                                <% else %>
                                <option  value="<%= state.id %>"><%= state.name %></option>
                                <% end %>
                                <% end %>
                            </select>
                        </div>
                        <input type="hidden" value="0" name="filter" id="filter_ticket">
                        <div class="btn-group">
                            <%= submit_tag 'Filtrar', class: 'btn btn-info'%>
                        </div>
                    <% end %>
                </div>
                <section id="flip-scroll">
                    <table class="table table-bordered table-striped table-condensed cf">
                        <thead>
                            <tr class="info">
                                <td>Titulo</td>
                                <td>Creada</td>
                                <td>Asignada</td>
                                <td>Emitida</td>
                                <!-- <td>Vence</td> -->
                                <td>Categoria</td>
                                <td>Estado</td>
                                <td>Acciones</td>
                            </tr>
                        </thead>
                        <tbody>
                            <% if @tickets.count > 0%>
                            <% for ticket in @tickets %>
                                <tr>
                                    <td><%= ticket.title %></td>
                                    <td><%= ticket.client.full_name %></td>
                                    <td><%= ticket.agents.collect { |a| a.full_name }.join(', ') %></td>
                                    <td><%= ticket.created_at.strftime "%d/%m/%Y" %></td>
                                    <!-- <td><%= ticket.expire_at %></td> -->
                                    <td><%= ticket.categories.collect{ |c| c.name }.join(',') %></td>
                                    <td>
                                        <span class="label" style="background-color: <%=ticket.current_state.color%> "><%= ticket.current_state.name %></span>
                                    </td>
                                    <td>
                                        <div class="btn-group">
                                            <a href="<%=url_for controller: "ticket", action: "ticket", id: ticket.id %>" class="btn btn-default" title="Contestar" rel="tooltip">
                                                <i class="glyphicon glyphicon-envelope"></i>
                                            </a>
                                            <a href="<%=url_for controller: "solution", action: "solution", id: ticket.id %>" class="btn btn-default" title="Resolver" rel="tooltip">
                                                <i class="glyphicon glyphicon-thumbs-up"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            <%  end 
                                end%>
                            <% if @tickets.count <= 0%>
                            <tr>
                                <td colspan = "6">No hay registros que mostrar</td>
                            </tr>
                            <% end %>
                        </tbody>
                    </table>
                </section>
                <% if @tickets.count > 0 %>
                    <%= pagination_tag @pagination, "ticket", "index" %>
                <% end %>
                <a href="#myModal-1" data-toggle="modal" class="btn btn-info">
                    Crear Ticket
                </a>
                <%= render :partial => "new" %>
            </div>
        </section>
    </div>
</div>